parameters:
  extRepoUrl : ""
  extRepoDir : ""

steps:
  - script: 'git clone -c http.extraheader="AUTHORIZATION: bearer $(System.AccessToken)" %EXTREPO_URL% %EXTREPO_DIR% 2>&1'
    displayName: 'Fetch external repo'
    env:
      EXTREPO_URL: ${{parameters.extRepoUrl}}
      EXTREPO_DIR: ${{parameters.extRepoDir}}
    timeoutInMinutes: 0

  - task: CopyFiles@2
    displayName: 'Copy CodeSign files'
    inputs:
      SourceFolder: '${{parameters.extRepoDir}}/CodeSign'
      TargetFolder: 'CodeSign'

  - task: CopyFiles@2
    displayName: 'Copy RDMA'
    inputs:
      SourceFolder: '${{parameters.extRepoDir}}/ProtoSDK/RDMA'
      TargetFolder: 'ProtoSDK/RDMA'

  - task: PowerShell@2
    inputs:
      filePath: '$(Build.SourcesDirectory)/CodeSign/Execute-SignTestSuites.ps1 -TestSuiteName $(test.testSuiteName)'
      workingDirectory: '$(Build.SourcesDirectory)/CodeSign'